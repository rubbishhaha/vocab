<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Vocab Quiz - Flash Cards</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		body {
			font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 20px;
			background-image: url('asset/more-arcaea-story-art-v0-fi96sj0vpm891.jpg');
			background-size: cover;
			background-position: center;
			position: relative;
		}
		
		body::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.3);
			z-index: 1;
		}
		
		.quiz-container {
			position: relative;
			z-index: 2;
			max-width: 600px;
			width: 100%;
		}
		
		.quiz-header {
			text-align: center;
			margin-bottom: 30px;
			color: white;
		}
		
		.quiz-header h1 {
			font-size: 2.5rem;
			margin-bottom: 10px;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		}
		
		.progress-info {
			background: rgba(255, 255, 255, 0.2);
			backdrop-filter: blur(10px);
			padding: 15px;
			border-radius: 15px;
			color: white;
			text-align: center;
			margin-bottom: 30px;
		}
		
		.flashcard-container {
			perspective: 1000px;
			height: 400px;
			position: relative;
			margin: 0 auto;
		}
		
		.flashcard {
			width: 100%;
			height: 100%;
			position: absolute;
			top: 0;
			left: 0;
			transform-style: preserve-3d;
			transition: transform 0.6s;
			cursor: pointer;
		}
		
		.flashcard.flipped {
			transform: rotateY(180deg);
		}
		
		.flashcard.slide-out {
			transform: translateX(100%) rotate(20deg);
			opacity: 0;
			transition: all 0.8s ease-in-out;
		}
		
		.flashcard.slide-in {
			transform: translateX(-100%) rotate(-20deg);
			opacity: 0;
			animation: slideIn 0.8s ease-out forwards;
		}
		
		@keyframes slideIn {
			to {
				transform: translateX(0) rotate(0);
				opacity: 1;
			}
		}
		
		.card-face {
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			backface-visibility: hidden;
			border-radius: 20px;
			padding: 30px 40px;
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			align-items: center;
			text-align: center;
			box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
			background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
			background-image: url('asset/download.jpeg');
			background-size: cover;
			background-position: center;
			overflow-y: auto;
			overflow-x: hidden;
		}
		
		.card-face::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(255, 255, 255, 0.85);
			border-radius: 20px;
			z-index: 1;
		}
		
		.card-face > * {
			position: relative;
			z-index: 2;
		}
		
		.card-back {
			transform: rotateY(180deg);
			background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
			background-image: url('asset/images.jpeg');
			color: white;
		}
		
		.card-back::before {
			background: rgba(238, 90, 36, 0.85);
		}
		
		.card-front h2 {
			font-size: 2rem;
			color: #333;
			margin: 0 0 20px 0;
			word-wrap: break-word;
			max-width: 100%;
		}
		
		.card-back h2 {
			font-size: 1.5rem;
			margin: 0 0 20px 0;
		}
		
		.card-back p {
			font-size: 1.1rem;
			line-height: 1.6;
			max-width: 100%;
			word-wrap: break-word;
			margin: 0;
		}
		
		.answer-section {
			margin-top: 30px;
			text-align: center;
		}
		
		.answer-input {
			width: 100%;
			max-width: 400px;
			padding: 15px;
			font-size: 1.1rem;
			border: none;
			border-radius: 25px;
			outline: none;
			background: rgba(255, 255, 255, 0.9);
			backdrop-filter: blur(10px);
			margin-bottom: 20px;
			text-align: center;
		}
		
		.answer-buttons {
			display: flex;
			gap: 15px;
			justify-content: center;
			flex-wrap: wrap;
		}
		
		.btn {
			padding: 12px 25px;
			border: none;
			border-radius: 25px;
			font-size: 1rem;
			cursor: pointer;
			transition: all 0.3s ease;
			text-decoration: none;
			display: inline-block;
		}
		
		.btn-primary {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}
		
		.btn-success {
			background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
			color: white;
		}
		
		.btn-danger {
			background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
			color: white;
		}
		
		.btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
		}
		
		.completion-screen {
			text-align: center;
			color: white;
			display: none;
		}
		
		.completion-screen.show {
			display: block;
			animation: fadeIn 1s ease-in;
		}
		
		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(30px); }
			to { opacity: 1; transform: translateY(0); }
		}
		
		.completion-screen h1 {
			font-size: 3rem;
			margin-bottom: 20px;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		}
		
		.completion-screen p {
			font-size: 1.2rem;
			margin-bottom: 30px;
		}
		
		.floating-particles {
			position: absolute;
			width: 100%;
			height: 100%;
			overflow: hidden;
			z-index: 1;
		}
		
		.particle {
			position: absolute;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 50%;
			animation: float 6s infinite ease-in-out;
		}
		
		@keyframes float {
			0%, 100% { transform: translateY(0) rotate(0deg); }
			50% { transform: translateY(-20px) rotate(180deg); }
		}
		
		.wrong-feedback {
			background: rgba(255, 107, 107, 0.9);
			color: white;
			padding: 10px 20px;
			border-radius: 15px;
			margin-top: 10px;
			animation: shake 0.5s ease-in-out;
		}
		
		@keyframes shake {
			0%, 100% { transform: translateX(0); }
			25% { transform: translateX(-5px); }
			75% { transform: translateX(5px); }
		}
	</style>
</head>
<body>
	<div class="floating-particles"></div>
	
	<div class="quiz-container">
		<div class="quiz-header">
			<h1>ðŸ“š Vocab Quiz</h1>
		</div>
		
		<div class="progress-info">
			<div>Progress: <span id="current">0</span> / <span id="total">0</span></div>
			<div>Remaining: <span id="remaining">0</span> cards</div>
		</div>
		
		<div class="flashcard-container" id="flashcardContainer">
			<div class="flashcard" id="flashcard">
				<div class="card-face card-front">
					<h2 id="questionText">Loading...</h2>
				</div>
				<div class="card-face card-back">
					<h2>Definition:</h2>
					<p id="answerText">Loading...</p>
				</div>
			</div>
		</div>
		
		<div class="answer-section" id="answerSection">
			<input type="text" class="answer-input" id="answerInput" placeholder="Type your answer here..." />
			<div class="answer-buttons">
				<button class="btn btn-primary" id="submitBtn">Submit Answer</button>
				<button class="btn btn-danger" id="showAnswerBtn">Show Answer</button>
			</div>
			<div id="feedback"></div>
		</div>
		
		<div class="completion-screen" id="completionScreen">
			<h1>ðŸŽ‰ Congratulations!</h1>
			<p>You've completed all the vocabulary cards!</p>
			<a href="index.html" class="btn btn-success">Return to Main Page</a>
		</div>
	</div>

	<script>
		function todayStr(d = new Date()){ return d.toISOString().slice(0,10); }

		async function apiGetState(){
			const res = await fetch('/api/state');
			if(!res.ok) throw new Error('Failed to load state');
			return res.json();
		}
		
		async function apiPutState(st){
			await fetch('/api/state', { method:'PUT', headers:{'content-type':'application/json'}, body: JSON.stringify(st) });
		}

		function getDueItems(items){
			const dueDays = [1,2,5,8];
			const now = todayStr();
			return items.filter(it => {
				const daysSinceAdded = daysBetween(it.dateAdded, now);
				if(!dueDays.includes(daysSinceAdded)) return false;
				return !it.reviews.includes(now);
			});
		}

		function daysBetween(aStr, bStr){
			const a = new Date(aStr+'T00:00:00');
			const b = new Date(bStr+'T00:00:00');
			const ms = b - a;
			return Math.floor(ms / (1000*60*60*24));
		}

		class QuizManager {
			constructor() {
				this.state = null;
				this.quizItems = [];
				this.currentIndex = 0;
				this.answered = 0;
				this.isFlipped = false;
				this.init();
			}

			async init() {
				try {
					this.state = await apiGetState();
					this.quizItems = getDueItems(this.state.items);
					this.shuffleArray(this.quizItems);
					
					if (this.quizItems.length === 0) {
						this.showCompletion();
						return;
					}
					
					this.updateProgress();
					this.showCurrentCard();
					this.setupEventListeners();
					this.createFloatingParticles();
				} catch (error) {
					console.error('Failed to initialize quiz:', error);
				}
			}

			shuffleArray(array) {
				for (let i = array.length - 1; i > 0; i--) {
					const j = Math.floor(Math.random() * (i + 1));
					[array[i], array[j]] = [array[j], array[i]];
				}
			}

			setupEventListeners() {
				const answerInput = document.getElementById('answerInput');
				const submitBtn = document.getElementById('submitBtn');
				const showAnswerBtn = document.getElementById('showAnswerBtn');
				const flashcard = document.getElementById('flashcard');

				submitBtn.addEventListener('click', () => this.checkAnswer());
				showAnswerBtn.addEventListener('click', () => this.showAnswer());
				flashcard.addEventListener('click', () => this.flipCard());
				
				answerInput.addEventListener('keypress', (e) => {
					if (e.key === 'Enter') this.checkAnswer();
				});
			}

			showCurrentCard() {
				if (this.currentIndex >= this.quizItems.length) {
					this.showCompletion();
					return;
				}

				const item = this.quizItems[this.currentIndex];
				document.getElementById('questionText').textContent = item.def;
				document.getElementById('answerText').textContent = item.word;
				document.getElementById('answerInput').value = '';
				document.getElementById('feedback').innerHTML = '';
				this.isFlipped = false;
				
				const flashcard = document.getElementById('flashcard');
				flashcard.classList.remove('flipped', 'slide-out');
				flashcard.classList.add('slide-in');
				
				setTimeout(() => {
					flashcard.classList.remove('slide-in');
				}, 800);
			}

			flipCard() {
				const flashcard = document.getElementById('flashcard');
				flashcard.classList.toggle('flipped');
				this.isFlipped = !this.isFlipped;
			}

			checkAnswer() {
				const userAnswer = document.getElementById('answerInput').value.trim().toLowerCase();
				const correctAnswer = this.quizItems[this.currentIndex].word.trim().toLowerCase();
				
				if (userAnswer === correctAnswer) {
					this.handleCorrectAnswer();
				} else {
					this.handleWrongAnswer();
				}
			}

			async handleCorrectAnswer() {
				const item = this.quizItems[this.currentIndex];
				
				// Mark as reviewed
				if (!item.reviews.includes(todayStr())) {
					item.reviews.push(todayStr());
				}
				
				// Save state
				await apiPutState(this.state);
				
				// Show success feedback
				const feedback = document.getElementById('feedback');
				feedback.innerHTML = '<div style="background: rgba(86, 171, 47, 0.9); color: white; padding: 10px 20px; border-radius: 15px; margin-top: 10px;">Correct! ðŸŽ‰</div>';
				
				// Remove from quiz items
				this.quizItems.splice(this.currentIndex, 1);
				this.answered++;
				
				setTimeout(() => {
					this.slideOutCard(() => {
						this.updateProgress();
						this.showCurrentCard();
					});
				}, 1000);
			}

			handleWrongAnswer() {
				const correctAnswer = this.quizItems[this.currentIndex].word;
				const feedback = document.getElementById('feedback');
				feedback.innerHTML = `<div class="wrong-feedback">Incorrect! The correct answer is: <strong>${correctAnswer}</strong></div>`;
				
				// Show the answer by flipping the card
				setTimeout(() => {
					this.showAnswer();
					// Move to end of queue after showing answer
					setTimeout(() => {
						const wrongItem = this.quizItems.splice(this.currentIndex, 1)[0];
						this.quizItems.push(wrongItem); // Add to end
						this.slideOutCard(() => {
							this.updateProgress();
							this.showCurrentCard();
						});
					}, 3000);
				}, 1000);
			}

			showAnswer() {
				if (!this.isFlipped) {
					this.flipCard();
				}
			}

			slideOutCard(callback) {
				const flashcard = document.getElementById('flashcard');
				flashcard.classList.add('slide-out');
				setTimeout(callback, 800);
			}

			updateProgress() {
				document.getElementById('current').textContent = this.answered;
				document.getElementById('total').textContent = this.answered + this.quizItems.length;
				document.getElementById('remaining').textContent = this.quizItems.length;
			}

			showCompletion() {
				document.getElementById('flashcardContainer').style.display = 'none';
				document.getElementById('answerSection').style.display = 'none';
				document.getElementById('completionScreen').classList.add('show');
			}

			createFloatingParticles() {
				const container = document.querySelector('.floating-particles');
				for (let i = 0; i < 20; i++) {
					const particle = document.createElement('div');
					particle.classList.add('particle');
					particle.style.left = Math.random() * 100 + '%';
					particle.style.top = Math.random() * 100 + '%';
					particle.style.width = (Math.random() * 10 + 5) + 'px';
					particle.style.height = particle.style.width;
					particle.style.animationDelay = Math.random() * 6 + 's';
					particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
					container.appendChild(particle);
				}
			}
		}

		// Initialize quiz when page loads
		document.addEventListener('DOMContentLoaded', () => {
			new QuizManager();
		});
	</script>
</body>
</html>